---
const {gaId} = Astro.props;
---

{gaId && import.meta.env.PROD && (
  <>
    <script 
      type="text/partytown" 
      async 
      src={`https://www.googletagmanager.com/gtag/js?id=${gaId}`}
    ></script>

    <script type="text/partytown" is:inline data-gaid="{gaId}">
      const gaId = document.currentScript.dataset.gaid;
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        window.dataLayer.push(arguments);
      }
      gtag('js', new Date());
      gtag('config', gaId);
    </script>

    <script is:inline data-gaid={gaId}>
      document.addEventListener('astro:after-swap', () => {
      const gaId = document.currentScript.dataset.gaid;
      if (window.gtag) {
        window.gtag('config', gaId, {
        page_path: window.location.pathname,
      });}
    });
    </script>
  </>
)}