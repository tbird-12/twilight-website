---
const gaId = import.meta.env.PUBLIC_GA_ID;
---

{gaId && import.meta.env.PROD && (
  <>
    <script 
      type="text/partytown" 
      async 
      src={`https://www.googletagmanager.com/gtag/js?id=${gaId}`}
    ></script>

    <script type="text/partytown" define:vars={{ gaId }}>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag('js', new Date());
      gtag('config', gaId);
    </script>

    <script is:inline define:vars={{ gaId }}>
      document.addEventListener('astro:after-swap', () => {
        if (window.gtag) {
          window.gtag('config', gaId, {
            page_path: window.location.pathname,
          });
        }
      });
    </script>
  </>
)}